{%- set pi = 3.141592 -%}
{%- set cyl_r = 0.001 -%}
{%- set cyl_l = 0.03 -%}
{%- set cyl_m = 0.0005 -%}
{%- set jun_m = 0.0005 -%}
{%- set jun_r = 0.0005 -%}
{%- set box_m = 1.0 -%}
{%- set box_x = 0.6 -%}
{%- set box_y = 0.3 -%}
{%- set box_z = 0.3 -%}
{%- set number_elements = 50 -%}

<robot name=test>


<link name="firefly_baselink">
</link>
<joint name="special_joint_0" type="fixed">
  <parent link="junta3_{{number_elements-1}}_0"/>
  <child link="firefly_baselink"/>
  <origin rpy="-{{pi/2}} 0 0" xyz="0 0 0.01"/>
</joint>


{%- macro tether_cylinder_link(n) -%}
  <link name="link_cylinder_{{n}}">
    <visual>
      <geometry>
        <cylinder length="{{cyl_l}}" radius="{{cyl_r}}"/>
      </geometry>
      <material name="black">
        <color rgba="0 0 0 1"/>
      </material>
    </visual>
    <collision>
      <geometry>
        <cylinder length="{{cyl_l}}" radius="{{cyl_r}}"/>
      </geometry>
    </collision>
    <inertial>
      <mass value="{{cyl_m}}"/>
      {%- set cyl_i = 1/12*cyl_m*(3*cyl_r**2+cyl_l**2) -%}
      {%- set cyl_iz = 1/2*cyl_m*cyl_r**2 -%}
      <inertia ixx="{{cyl_i}}" iyy="{{cyl_i}}" izz="{{cyl_iz}}" ixy="0" ixz="0" iyz="0"/>
    </inertial>
  </link>
{%- endmacro -%}

<!--tether_cylinder_joint-->
{%- macro tether_cylinder_joint(n) -%}
  <link name="junta1_{{n}}">
    <inertial>
      <mass value="{{jun_m}}" />
      <!--<inertia ixx="{{jun_i}}" ixy="0" ixz="0" iyy="{{jun_i}}" iyz="0" izz="{{jun_i}}" />-->
      <inertia ixx="5.8083e-4" ixy="0" ixz="0" iyy="3.0833e-5" iyz="0" izz="5.9083e-4" />
    </inertial>
  </link>
  <link name="junta2_{{n}}">
    <inertial>
      <mass value="{{jun_m}}" />
      <inertia ixx="5.8083e-4" ixy="0" ixz="0" iyy="3.0833e-5" iyz="0" izz="5.9083e-4" />
    </inertial>
  </link>
  <link name="junta3_{{n}}">
    <inertial>
      <mass value="{{jun_m}}" />
      <inertia ixx="5.8083e-4" ixy="0" ixz="0" iyy="3.0833e-5" iyz="0" izz="5.9083e-4" />
    </inertial>
  </link>

  <!--base_cylinder_joint-->
  <joint name="joint1_{{n}}" type="continuous">
    {% if n > 0 %}
    <parent link="link_cylinder_{{n-1}}"/>
    <origin rpy="0 0 0" xyz="0 0 -{{cyl_l/2}}"/>
    {% endif %}

    {% if n == 0 %}
    <parent link="base_link"/>
    <!--base_cylinder_joint-->
    <origin rpy="{{pi/2}} 0 0" xyz="{{box_x/2}} {{box_y/2}} {{box_z/2}}"/>
    {% endif %}

    <child link="junta1_{{n}}"/>

    <axis xyz="0 1 0" />
  </joint>
  <joint name="joint2_{{n}}" type="continuous">
    <parent link="junta1_{{n}}"/>
    <child link="junta2_{{n}}"/>
    <axis xyz="0 0 1" />
  </joint>
  <joint name="joint3_{{n}}" type="continuous">
    <parent link="junta2_{{n}}"/>
    <child link="junta3_{{n}}"/>
    <axis xyz="1 0 0" />
  </joint>
  <joint name="jointfixed_{{n}}" type="fixed">
    <parent link="junta3_{{n}}"/>
    <child link="link_cylinder_{{n}}"/>
    <origin rpy="0 0 0" xyz="0 0 -{{cyl_l/2}}"/>
  </joint>
{%- endmacro -%}


<!--base_component-->
  <link name="base_link">
    <visual>
      <geometry>
        <box size="{{box_x}} {{box_y}} {{box_z}}"/>
      </geometry>
      <material name="silver">
        <color rgba="0.75 0.75 0.75 1"/>
      </material>
    </visual>
    <collision>
      <geometry>
        <box size="{{box_x}} {{box_y}} {{box_z}}"/>
      </geometry>
    </collision>
    <inertial>
      <mass value="{{box_m}}"/>
      {%- set box_ix = 1/12*box_m*(box_y**2+box_z**2) -%}
      {%- set box_iy = 1/12*box_m*(box_x**2+box_z**2) -%}
      {%- set box_iz = 1/12*box_m*(box_x**2+box_y**2) -%}
      <inertia ixx="{{box_ix}}" iyy="{{box_iy}}" izz="{{box_iz}}" ixy="0" ixz="0" iyz="0"/>
    </inertial>
  </link>


  <!-- main-->
  {% for n in range(0,number_elements) -%}
  {{tether_cylinder_link(n)}}
  {{tether_cylinder_joint(n)}}
  {% endfor -%}
</robot>
